angular.module("adminPanel",["ui.router","angular-jwt","angular-storage","adminPanel.authentication","angular-md5","adminPanel.dashBoardCtrl","dashBoard.pagesCtrl","ngSanitize","dashboard.settingsCtrl"]).config(["$stateProvider","$urlRouterProvider","$httpProvider","jwtInterceptorProvider","$locationProvider",function(a,b,c,d,e){return a.state("auth",{url:"/auth/:type/:email/:value",templateUrl:"templates/auth.html",controller:"authController"}).state("dashboard",{url:"/dashboard","abstract":!0,templateUrl:"templates/dashboard.html",controller:"dashBoardController",data:{requiresLogin:!0}}).state("dashboard.home",{url:"",templateUrl:"templates/dashboardHome.html",data:{requiresLogin:!0}}).state("dashboard.pages",{url:"/manage_pages",templateUrl:"templates/dashboardManagePages.html",controller:"dashBoardPagesController",data:{requiresLogin:!0}}).state("dashboard.createPage",{url:"/create_page",templateUrl:"templates/dashboardCreatePages.html",controller:"dashBoardCreatePagesController",data:{requiresLogin:!0}}).state("dashboard.editPage",{url:"/edit_page/:id",templateUrl:"templates/dashboardEditPage.html",controller:"dashBoardEditPagesController",data:{requiresLogin:!0}}).state("dashboard.settings",{url:"/settings",templateUrl:"templates/dashboardSettings.html",controller:"dashBoardSettingsController",data:{requiresLogin:!0}}).state("dashboard.manageUsers",{url:"/manage_users",templateUrl:"templates/dashboardManageUsers.html",controller:"dashBoardManageUsersController",data:{requiresLogin:!0}}).state("dashboard.manageMail",{url:"/manage_mail",templateUrl:"templates/dashboardManageMail.html",controller:"dashBoardManageMailController",data:{requiresLogin:!0}}).state("dashboard.manageComments",{url:"/manage_comments",templateUrl:"templates/dashboardManageComments.html",controller:"dashBoardManageCommentsController",data:{requiresLogin:!0}}),b.otherwise("/auth"),d.tokenGetter=["config","store",function(a,b){var c;return".html"===a.url.substr(a.url.length-5)?null:(c=b.get("user"),_.isNull(c.token)&&_.isUndefined(c.token)?void 0:a.headers.Authorization=c.token)}],c.interceptors.push("jwtInterceptor"),b.when("dashboard","dashboard.home"),b.otherwise("/auth/login//")}]).run(["$rootScope","$state","store","jwtHelper","$http","API","$q",function(a,b,c,d,e,f,g){return a.$on("$stateChangeStart",function(a,h){var i,j,k,l;if(j=function(){var a;return a=g.defer(),e.post(f.url+"refreshToken.php",null).then(function(b){return a.resolve(b.data)},function(b){return console.log("Error"),a.reject(data)}),a.promise},l=c.get("user"),h.data&&h.data.requiresLogin){if(_.isNull(l)||_.isUndefined(l)||d.isTokenExpired(l.token))return a.preventDefault(),b.go("auth",{type:"login",email:null,value:null});if(i=moment(l.lastUpdate,"DD-MM-YYYY"),k=moment().isSame(moment(i),"day"),!k)return j().then(function(d){var e,f;return e=d,_.isNull(e.token)&&_.isUndefined(e.token)?(a.preventDefault(),b.go("auth",{type:"login",email:null,value:null})):(f={id:e.id,token:e.token,username:e.username,lastUpdate:moment().format("DD-MM-YYYY")},c.set("user",f))},function(b){return a.preventDefault()})}})}]).constant("API",{url:"../apis/source/"});