angular.module("adminPanel",["ui.router","angular-jwt","angular-storage","adminPanel.authentication","angular-md5","adminPanel.dashBoardCtrl","dashBoard.pagesCtrl","ngSanitize","dashboard.settingsCtrl"]).config(["$stateProvider","$urlRouterProvider","$httpProvider","jwtInterceptorProvider","$locationProvider",function(e,t,a,r){return e.state("auth",{url:"/auth/:type/:email/:value",templateUrl:"templates/auth.html",controller:"authController"}).state("dashboard",{url:"/dashboard","abstract":!0,templateUrl:"templates/dashboard.html",controller:"dashBoardController",data:{requiresLogin:!0}}).state("dashboard.home",{url:"",templateUrl:"templates/dashboardHome.html",data:{requiresLogin:!0}}).state("dashboard.pages",{url:"/manage_pages",templateUrl:"templates/dashboardManagePages.html",controller:"dashBoardPagesController",data:{requiresLogin:!0}}).state("dashboard.createPage",{url:"/create_page",templateUrl:"templates/dashboardCreatePages.html",controller:"dashBoardCreatePagesController",data:{requiresLogin:!0}}).state("dashboard.editPage",{url:"/edit_page/:id",templateUrl:"templates/dashboardEditPage.html",controller:"dashBoardEditPagesController",data:{requiresLogin:!0}}).state("dashboard.settings",{url:"/settings",templateUrl:"templates/dashboardSettings.html",controller:"dashBoardSettingsController",data:{requiresLogin:!0}}).state("dashboard.manageUsers",{url:"/manage_users",templateUrl:"templates/dashboardManageUsers.html",controller:"dashBoardManageUsersController",data:{requiresLogin:!0}}).state("dashboard.manageMail",{url:"/manage_mail",templateUrl:"templates/dashboardManageMail.html",controller:"dashBoardManageMailController",data:{requiresLogin:!0}}).state("dashboard.manageComments",{url:"/manage_comments",templateUrl:"templates/dashboardManageComments.html",controller:"dashBoardManageCommentsController",data:{requiresLogin:!0}}),t.otherwise("/auth"),r.tokenGetter=["config","store",function(e,t){var a;return".html"===e.url.substr(e.url.length-5)?null:(a=t.get("user"),_.isNull(a.token)&&_.isUndefined(a.token)?void 0:e.headers.Authorization=a.token)}],a.interceptors.push("jwtInterceptor"),t.when("dashboard","dashboard.home"),t.otherwise("/auth/login//")}]).run(["$rootScope","$state","store","jwtHelper","$http","API","$q",function(e,t,a,r,o,l,n){return e.$on("$stateChangeStart",function(e,s){var d,i,u,m;if(i=function(){var e;return e=n.defer(),o.post(l.url+"refreshToken.php",null).then(function(t){return e.resolve(t.data)},function(){return console.log("Error"),e.reject(data)}),e.promise},m=a.get("user"),s.data&&s.data.requiresLogin){if(_.isNull(m)||_.isUndefined(m)||r.isTokenExpired(m.token))return e.preventDefault(),t.go("auth",{type:"login",email:null,value:null});if(d=moment(m.lastUpdate,"DD-MM-YYYY"),u=moment().isSame(moment(d),"day"),!u)return i().then(function(r){var o,l;return o=r,_.isNull(o.token)&&_.isUndefined(o.token)?(e.preventDefault(),t.go("auth",{type:"login",email:null,value:null})):(l={id:o.id,token:o.token,username:o.username,lastUpdate:moment().format("DD-MM-YYYY")},a.set("user",l))},function(){return e.preventDefault()})}})}]).constant("API",{url:"../apis/source/"});