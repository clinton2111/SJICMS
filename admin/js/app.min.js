angular.module("adminPanel",["ui.router","angular-jwt","angular-storage","adminPanel.authentication","angular-md5","adminPanel.dashBoardCtrl","dashBoard.pagesCtrl","ngSanitize","dashboard.settingsCtrl"]).config(["$stateProvider","$urlRouterProvider","$httpProvider","jwtInterceptorProvider","$locationProvider",function(e,t,n,r,i){return e.state("auth",{url:"/auth/:type/:email/:value",templateUrl:"templates/auth.html",controller:"authController"}).state("dashboard",{url:"/dashboard","abstract":!0,templateUrl:"templates/dashboard.html",controller:"dashBoardController",data:{requiresLogin:!0}}).state("dashboard.home",{url:"",templateUrl:"templates/dashboardHome.html",data:{requiresLogin:!0}}).state("dashboard.pages",{url:"/manage_pages",templateUrl:"templates/dashboardManagePages.html",controller:"dashBoardPagesController",data:{requiresLogin:!0}}).state("dashboard.createPage",{url:"/create_page",templateUrl:"templates/dashboardCreatePages.html",controller:"dashBoardCreatePagesController",data:{requiresLogin:!0}}).state("dashboard.editPage",{url:"/edit_page/:id",templateUrl:"templates/dashboardEditPage.html",controller:"dashBoardEditPagesController",data:{requiresLogin:!0}}).state("dashboard.settings",{url:"/settings",templateUrl:"templates/dashboardSettings.html",controller:"dashBoardSettingsController",data:{requiresLogin:!0}}).state("dashboard.manageUsers",{url:"/manage_users",templateUrl:"templates/dashboardManageUsers.html",controller:"dashBoardManageUsersController",data:{requiresLogin:!0}}),t.otherwise("/auth"),r.tokenGetter=["config","store",function(e,t){var n;if(e.url.substr(e.url.length-5)===".html")return null;n=t.get("user");if(!_.isNull(n.token)||!_.isUndefined(n.token))return e.headers.Authorization=n.token}],n.interceptors.push("jwtInterceptor"),t.when("dashboard","dashboard.home"),t.otherwise("/auth/login//")}]).run(["$rootScope","$state","store","jwtHelper","$http","API","$q",function(e,t,n,r,i,s,o){return e.$on("$stateChangeStart",function(e,u){var a,f,l,c;f=function(){var e;return e=o.defer(),i.post(s.url+"refreshToken.php",null).then(function(t){return e.resolve(t.data)},function(t){return console.log("Error"),e.reject(data)}),e.promise},c=n.get("user");if(u.data&&u.data.requiresLogin){if(_.isNull(c)||_.isUndefined(c)||r.isTokenExpired(c.token))return e.preventDefault(),t.go("auth",{type:"login",email:null,value:null});a=moment(c.lastUpdate,"DD-MM-YYYY"),l=moment().isSame(moment(a),"day");if(!l)return f().then(function(r){var i,s;return i=r,!_.isNull(i.token)||!_.isUndefined(i.token)?(s={id:i.id,token:i.token,username:i.username,lastUpdate:moment().format("DD-MM-YYYY")},n.set("user",s)):(e.preventDefault(),t.go("auth",{type:"login",email:null,value:null}))},function(t){return e.preventDefault()})}})}]).constant("API",{url:"../apis/source/"});