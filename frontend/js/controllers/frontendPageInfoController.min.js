angular.module("frontend.main").controller("frontendPageInfoController",["$scope","fetcherFactory","$stateParams","$state","API","vcRecaptchaService","CommentFactory",function(e,t,n,r,i,s,o){var u;return e.$on("$viewContentLoaded",function(){return $(".tooltipped").tooltip({delay:50})}),e.anonymousState=!1,e.publicKey=i.g_reCaptchaKey,e.showLoader=!1,u=0,e.fetchPageInfo=function(){var i,s;return s=moment().format("YYYY-MM-DD h:mm:ss a"),e.showLoader=!0,i=n.id,t.fetchPageInfo(i,s).then(function(t){var n;if(t.data.status==="Success")return n=t.data.results,e.post={author_name:n[0].author_name,post_content:n[0].post_content,post_title:n[0].post_title,publish_date:n[0].publish_date},e.comments=n[0].comments,Materialize.toast("Page Loaded","4000");if(t.data.status==="Scheduled")return r.go("home.later");if(t.data.status==="404")return r.go("home.404")},function(e){return Materialize.toast("Something went wrong",4e3)})["finally"](function(){return e.showLoader=!1})},e.openModal=function(){return $("#commentModal").openModal()},e.postComment=function(){if(e.anonymousState===!0||_.isNull(e.comment.name)||_.isUndefined(e.comment.name)||_.isEmpty(e.comment.name))e.comment.name="Anonymous";return s.getResponse()===""?(Materialize.toast("Please resolve the captcha",4e3),!1):(e.comment.g_recaptcha_response=s.getResponse(),e.comment.now=moment().format("YYYY-MM-DD h:mm:ss a"),e.comment.post_id=n.id,console.log(e.post),o.postComment(e.comment).then(function(t){var n;if(t.data.status==="Success")return n={name:e.comment.name,comment:e.comment.comment,time_posted:e.comment.now},e.comments.push(n),$("#commentModal").closeModal(),Materialize.toast(t.data.message,4e3);if(t.data.status==="Error")return Materialize.toast(t.data.message,4e3)},function(e){return Materialize.toast("Something went wrong",4e3)})["finally"](function(){}))},e.loadMoreComments=function(){return u=e.comments.length,o.loadMoreComments(n.id,u).then(function(t){var n;if(t.data.status==="Success")return n=t.data.results,_.each(n,function(t){return e.comments.push(t)}),Materialize.toast(t.data.message,4e3);if(t.data.status==="Error")return Materialize.toast(t.data.message,4e3)},function(e){return Materialize.toast("Something went wrong",4e3)})["finally"](function(){})}}]);